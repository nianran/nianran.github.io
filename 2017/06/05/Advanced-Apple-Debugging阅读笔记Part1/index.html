<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Advanced_Apple_Debugging阅读笔记Part1 · 红纸</title><meta name="description" content="Advanced_Apple_Debugging阅读笔记Part1 - HongZhi"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://www.zhz.io/atom.xml" title="红纸"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/nianran" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Advanced_Apple_Debugging阅读笔记Part1</h1><div class="post-info">Jun 5, 2017</div><div class="post-content"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>本文为<a href="https://store.raywenderlich.com/products/advanced-apple-debugging-and-reverse-engineering" target="_blank" rel="external">Advanced Apple Debugging &amp; Reverse Engineering</a>的第一章阅读笔记，<br>有不正之处望指正</p>
<h2 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h2><p>关闭Rootless模式</p>
<ul>
<li>重启电脑，启动后长按Commond+R</li>
<li>进入控制台</li>
<li>输入 csrutil disable; reboot</li>
<li>不久后就会重启电脑</li>
</ul>
<h3 id="File"><a href="#File" class="headerlink" title="File"></a>File</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ lldb /Projects/Sketch/build/Debug/Sketch.app </div><div class="line">&gt;&gt; Current executable set to &apos;/Projects/Sketch/build/Debug/Sketch.app&apos; (x86_64)</div></pre></td></tr></table></figure>
<p>等同于<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ lldb </div><div class="line">(lldb) file /Projects/Sketch/build/Debug/Sketch.app </div><div class="line">&gt;&gt; Current executable set to &apos;/Projects/Sketch/build/Debug/Sketch.app&apos; (x86_64).</div></pre></td></tr></table></figure></p>
<a id="more"></a>
<h3 id="process"><a href="#process" class="headerlink" title="process"></a>process</h3><ul>
<li>launch 启动执行目录的程序</li>
</ul>
<h3 id="image"><a href="#image" class="headerlink" title="image"></a>image</h3><ul>
<li><p>lookup </p>
<ul>
<li><p>-n NAME 查找具体代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(lldb) image lookup -n &quot;-[UIViewController viewDidLoad]&quot;</div></pre></td></tr></table></figure>
</li>
<li><p>-rn NAME 查找所有符合NAME规则的符号。符号可以正则，所以说符合规则</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">(lldb) image lookup -rn test</div><div class="line">#Swift</div><div class="line">(lldb) image lookup -rn Signals.SwiftTestClass.name.setter </div><div class="line">2 matches found in /Users/derekselander/Library/Developer/Xcode/DerivedData/Signals-bqrjxlceauwfuihjesxmgfodimef/Build/Products/Debug-iphonesimulator/Signals.app/Signals:</div><div class="line">      Address: Signals[0x000000010000aba0] (Signals.__TEXT.__text +38704)</div><div class="line">      Summary: Signals`@objc Signals.SwiftTestClass.name.setter :raywenderlich.com 47</div><div class="line">      Advanced Apple Debugging Chapter 4: Stopping in Code Swift.ImplicitlyUnwrappedOptional&lt;Swift.String&gt; at SwiftTestClass.swift</div><div class="line">      Address: Signals[0x000000010000ac60] (Signals.__TEXT.__text + 38896)</div><div class="line">      Summary: Signals`Signals.SwiftTestClass.name.setter :Swift.ImplicitlyUnwrappedOptional&lt;Swift.String&gt; at SwiftTestClass.swift</div><div class="line">#Mark 一下这边出现了两个，是因为这个工程既有Swift代码也有OC代码，苹果为了做桥接加了第一个后续可以无视</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h3 id="Breakpoint"><a href="#Breakpoint" class="headerlink" title="Breakpoint"></a>Breakpoint</h3><ul>
<li><p>设置断点</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">// 简写的形式</div><div class="line">(lldb) b -[UIViewController viewDidLoad]</div><div class="line"> Breakpoint 1: where = UIKit`-[UIViewController viewDidLoad], address = 0x0000000102bbd788</div><div class="line">//如果想在某个文件中的某行设置一个断点，可使用以下命令：</div><div class="line">(lldb) breakpoint set --file foo.c --line 12</div><div class="line">//如果想给某个函数设置断点，可使用以下命令：</div><div class="line">(lldb) breakpoint set --name foo</div><div class="line">//如果想给C++中所有命名为foo的方法设置断点，可以使用以下命令：</div><div class="line">(lldb) breakpoint set --method foo</div><div class="line"></div><div class="line"># 下面两者等价</div><div class="line">(lldb) b Breakpoints.SwiftTestClass.name.setter :Swift.ImplicitlyUnwrappedOptional&lt;Swift.String&gt;</div><div class="line">(lldb) rb SwiftTestClass.name.setter</div><div class="line"></div><div class="line"># 部分正则参考</div><div class="line">(lldb) rb name\.setter // image lookup后给所有匹配上name.setter的打上断点</div><div class="line">(lldb) rb &apos;\-\[UIViewController\ &apos; // 给这个类的所有方法打上断点</div><div class="line">(lldb) rb &apos;\-\[UIViewController(\(\w+\))?\ &apos;  // 给这个类的所有Category打上断点(没有验证)</div><div class="line">(lldb) rb . -f DetailViewController.swift // 给这个文件内的所有方法打上断点</div><div class="line">(lldb) rb . //给所有的方法打上断点 很危险</div><div class="line">(lldb) rb . -s UIKit // 只断点UIKit库里面的所有方法</div><div class="line"></div><div class="line"># 特殊用法</div><div class="line">^(@).* 这个需要考证是用来屏蔽上面说的桥接问题</div></pre></td></tr></table></figure>
</li>
<li><p>其他操作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">  # 断点列表</div><div class="line">  (lldb) breakpoint list 1</div><div class="line">  1: name = &apos;main&apos;, locations = 20, resolved = 20, hit count = 0</div><div class="line">1.1: where = Breakpoints`main + 22 at AppDelegate.swift:12, address =0x00000001057676e6, resolved, hit count = 0</div><div class="line">1.2: where = Foundation`-[NSThread main], address = 0x000000010584d182,resolved, hit count = 0</div><div class="line">1.3: where = Foundation`-[NSBlockOperation main], address =0x000000010585df4a, resolved, hit count = 0</div><div class="line">...</div><div class="line"></div><div class="line">  # 断点删除</div><div class="line">  (lldb) breakpoint delete 1</div><div class="line">  (lldb) breakpoint delete 1.1 这个准确的说是disable并不是真正意义上的删除</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="Expression-amp-po-amp-p"><a href="#Expression-amp-po-amp-p" class="headerlink" title="Expression &amp; po &amp; p"></a>Expression &amp; po &amp; p</h3><p>po =  expression -O –</p>
<p>Note: lldb的Context的问题，如果当前代码是在OC下的话要用OC语法，如果是在Swift的环境下要用Swift代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"># Swift环境下</div><div class="line">(lldb) po [UIApplication sharedApplication] # 不能这么使用</div><div class="line">(lldb) expression -l objc -O -- [UIApplication sharedApplication]</div><div class="line">(lldb) po UIApplication.shared </div><div class="line"></div><div class="line"># OC环境下</div><div class="line">(lldb) po $R0.title</div><div class="line">(lldb) expression -l swift -- $R0.title</div></pre></td></tr></table></figure></p>
<p>创建实例的时候要在实例名字前面加$符号，不然不能够正常使用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"># 反例</div><div class="line">(lldb) po id test = [NSObject new]</div><div class="line">(lldb) po test</div><div class="line">error: use of undeclared identifier &apos;test&apos;</div><div class="line"></div><div class="line"># 正确用法</div><div class="line">(lldb) po id $test = [NSObject new]</div><div class="line">(lldb) po $test</div><div class="line">&lt;NSObject: 0x60000001d190&gt;</div><div class="line">(lldb) expression -l swift -O -- $test</div></pre></td></tr></table></figure></p>
<p>细节：在用Expression调用方法的时候，设置的Breakpoint是不会被主动触发的。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># 不会被触发</div><div class="line">(lldb) expression -l swift -O -- $R0.viewDidLoad()</div><div class="line"># 会被触发</div><div class="line">(lldb) expression -l swift -O -i 0 -- $R0.viewDidLoad()</div></pre></td></tr></table></figure></p>
<h3 id="Thread-Frame-amp-Step"><a href="#Thread-Frame-amp-Step" class="headerlink" title="Thread, Frame &amp; Step"></a>Thread, Frame &amp; Step</h3><ul>
<li><p>Thread &amp; Frame</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"> # 打印当前栈内情况</div><div class="line">(lldb) thread backtrace</div><div class="line"> # 打印栈顶信息</div><div class="line">(lldb) frame info</div><div class="line">frame #0: 0x00000001075d0ae0 Signals`MasterViewController.viewWillAppear(animated=&lt;invalid&gt; (0xd1),self=0x00007fff5862dac0) -&gt; () at MasterViewController.swift:47</div><div class="line"> # 根据数据选择栈</div><div class="line"> (lldb) frame select 1</div><div class="line"> # 打印当前所在栈块内的实例</div><div class="line"> (lldb) frame variable</div><div class="line"> # 打印self 符号的所有实例</div><div class="line"> (lldb) frame variable -F self</div></pre></td></tr></table></figure>
</li>
<li><p>Step</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"># 重新启动程序</div><div class="line">(lldb) run</div><div class="line"># 继续</div><div class="line">(lldb) continue</div><div class="line"># 断点下一步 step over</div><div class="line">(lldb) next</div><div class="line"># 进入函数下一步 step into</div><div class="line">(lldb) step</div><div class="line"># 跳出当前函数 step out</div><div class="line">(lldb) finish</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="TypeFormat"><a href="#TypeFormat" class="headerlink" title="TypeFormat"></a>TypeFormat</h3><p><a href="https://sourceware.org/gdb/ onlinedocs/gdb/Output-Formats.html" target="_blank" rel="external">参考链接</a></p>
<h3 id="Customizing-Commands"><a href="#Customizing-Commands" class="headerlink" title="Customizing Commands"></a>Customizing Commands</h3><ol>
<li>LLDB支持自定义命令行操作 (著名的chisel就是使用这种方法进行编写的)。<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"># 这个命令相比大家都不陌生，是用来打印当前的视图结构的</div><div class="line">(lldb) po [[[[[UIApplication sharedApplication] keyWindow] rootViewController] view] recursiveDescription]</div><div class="line"></div><div class="line"># 自定义命令(运行时替换)</div><div class="line"># Note：如果想全局替换可以把这个写入~/.lldbinit里面即可</div><div class="line">(lldb) command alias -- Yay_Autolayout expression -l objc -O -- [[[[[UIApplication sharedApplication] keyWindow] rootViewController] view] recursiveDescription]</div><div class="line"></div><div class="line"># 下面的调用等价于第一个</div><div class="line">(lldb) Yay_Autolayout</div></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="正则表达"><a href="#正则表达" class="headerlink" title="正则表达"></a>正则表达</h3><ul>
<li>LLDB的正则实现原理是基于Shell的SED命令，详细可以参考sed命令<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">(lldb) command regex rlook &apos;s/(.+)/image lookup -rn %1/&apos;</div><div class="line">(lldb) rlook viewDidLoad</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="简写"><a href="#简写" class="headerlink" title="简写"></a>简写</h3><p>c = continue<br>ex = expression<br>b = breakpoint<br>n = next</p>
<h3 id="杂项"><a href="#杂项" class="headerlink" title="杂项"></a>杂项</h3><ul>
<li>$ ttys //查找当前终端的名称<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">~ $ tty</div><div class="line">&gt;&gt;  /dev/ttys027</div></pre></td></tr></table></figure>
</li>
</ul>
</div></article></div></main><footer><div class="paginator"><a href="/2017/09/10/晴明视频学习笔记-第二章/" class="prev">PREV</a><a href="/2016/12/31/我的2016年总结/" class="next">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'zhz';
var disqus_identifier = '2017/06/05/Advanced-Apple-Debugging阅读笔记Part1/';
var disqus_title = 'Advanced_Apple_Debugging阅读笔记Part1';
var disqus_url = 'http://www.zhz.io/2017/06/05/Advanced-Apple-Debugging阅读笔记Part1/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//zhz.disqus.com/count.js" async></script><div class="copyright"><p>© 2016 - 2018 <a href="http://www.zhz.io">HongZhi</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-82278125-1",'auto');ga('send','pageview');</script></body></html>