<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> RN晴明视频学习笔记 - 第四章 · 红纸</title><meta name="description" content="RN晴明视频学习笔记 - 第四章 - HongZhi"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://www.zhz.io/atom.xml" title="红纸"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/nianran" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">RN晴明视频学习笔记 - 第四章</h1><div class="post-info">Oct 11, 2017</div><div class="post-content"><h2 id="组件的生命周期"><a href="#组件的生命周期" class="headerlink" title="组件的生命周期"></a>组件的生命周期</h2><h3 id="详细的生命周期文档"><a href="#详细的生命周期文档" class="headerlink" title="详细的生命周期文档"></a>详细的生命周期文档</h3><p><a href="https://www.race604.com/react-native-component-lifecycle/" target="_blank" rel="noopener">博客</a></p>
<h3 id="其他Tips"><a href="#其他Tips" class="headerlink" title="其他Tips"></a>其他Tips</h3><ul>
<li>render中只做与渲染有关的操作，只读取、不修改任何数据（临时变量除外）<ul>
<li>因为界面的更改是经常的，所以render是经常触发的</li>
<li>所以如果你有修改数据等操作，就会多次触发，使结果难以预料</li>
<li>比如你执行setState，那么setState又触发render，就会导致死循环</li>
</ul>
</li>
<li>随组件加载只执行一次的操作，放在WillMount或者DidMount中<ul>
<li>比如远程取首页数据（fetch），比如弹出提示框</li>
</ul>
</li>
<li>记得在WillUnmount中销毁定时器和一些订阅事件</li>
<li>props发生变化，使用WillReceiveProps来处理（比如将变动同步给state）</li>
</ul>
<a id="more"></a>
<h2 id="组件之间的相互通信"><a href="#组件之间的相互通信" class="headerlink" title="组件之间的相互通信"></a>组件之间的相互通信</h2><h3 id="存在的情况"><a href="#存在的情况" class="headerlink" title="存在的情况"></a>存在的情况</h3><ol>
<li>父组件向子组件进行调用，传递</li>
<li>子组件之间的相互通信</li>
<li>子组件向父组件进行通信</li>
<li>全局跨任意组件间通信</li>
</ol>
<h3 id="父组件向子组件进行调用，传递-子组件之间的相互通信"><a href="#父组件向子组件进行调用，传递-子组件之间的相互通信" class="headerlink" title="父组件向子组件进行调用，传递/子组件之间的相互通信"></a>父组件向子组件进行调用，传递/子组件之间的相互通信</h3><ol>
<li>父组件将自身的state作为子组件的属性props进行传递，父组件调用setState,于是子组件的props相应变化</li>
<li>通过使用进行调用子组件的方法<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 推荐写法</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      &lt;CountDown ref=&#123;</div><div class="line">        instance =&gt; this.countDown = instance</div><div class="line">    &#125; /&gt;</div><div class="line">    )  </div><div class="line">  &#125;</div><div class="line">  componentDidMount() &#123;</div><div class="line">    this.countDown.add(10086);</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line">// 不推荐写法</div><div class="line">class App extends Component &#123;</div><div class="line">  render() &#123;</div><div class="line">    return (</div><div class="line">      &lt;CountDown ref=&#123;</div><div class="line">        instance =&gt; this.countDown = instance</div><div class="line">    &#125; /&gt;</div><div class="line">    )  </div><div class="line">  &#125;</div><div class="line">  componentDidMount() &#123;</div><div class="line">    this.countDown.add(10086);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="子组件向父组件进行通信"><a href="#子组件向父组件进行通信" class="headerlink" title="子组件向父组件进行通信"></a>子组件向父组件进行通信</h3><ol>
<li>父组件将函数作为props传递给子组件，子组件在需要的时候进行调用，可以将数据作为函数参数进行回传<ul>
<li>类似于iOS中的block<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">CountDown</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</div><div class="line">  state = &#123;</div><div class="line">    <span class="attr">count</span>: <span class="keyword">this</span>.props.time,</div><div class="line">  &#125;;</div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">const</span> &#123; count &#125; = <span class="keyword">this</span>.state;</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">        &lt;Text&gt;&#123;count&#125;&lt;/Text&gt;</div><div class="line">    )</div><div class="line">  &#125;</div><div class="line">  add = <span class="function">(<span class="params">time</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">this</span>.setState(&#123;</div><div class="line">      <span class="attr">count</span>: <span class="keyword">this</span>.state.count + time</div><div class="line">    &#125;)</div><div class="line">  &#125;</div><div class="line">  componentDidMount() &#123;</div><div class="line">    <span class="keyword">this</span>.timer = setInterval(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">      <span class="keyword">const</span> &#123; count &#125; = <span class="keyword">this</span>.state;</div><div class="line">      <span class="keyword">if</span> (count === <span class="number">0</span>) &#123;</div><div class="line">        <span class="keyword">this</span>.props.timeout &amp;&amp; <span class="keyword">this</span>.props.timeout( <span class="number">1</span> );</div><div class="line">        <span class="keyword">return</span> clearInterval(<span class="keyword">this</span>.timer);</div><div class="line">      &#125;</div><div class="line">      <span class="keyword">this</span>.setState(&#123;</div><div class="line">        <span class="attr">count</span>: count - <span class="number">1</span>,</div><div class="line">      &#125;);</div><div class="line">    &#125;, <span class="number">1000</span>);</div><div class="line">  &#125;</div><div class="line">  componentWillUnmount() &#123;</div><div class="line">    clearInterval(<span class="keyword">this</span>.timer);</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</div><div class="line">  addTime = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">    <span class="keyword">this</span>.countDown.add(<span class="number">5</span>)</div><div class="line">  &#125;</div><div class="line">  timeOut = <span class="function">(<span class="params">params</span>) =&gt;</span> &#123;</div><div class="line">    alert(<span class="string">'爸爸知道了'</span> + params)</div><div class="line">  &#125;</div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      &lt;View&gt;</div><div class="line">        &lt;TouchableOpacity onPress=&#123;this.addTime&#125;&gt;</div><div class="line">          延长十秒</div><div class="line">        &lt;/TouchableOpacity&gt;</div><div class="line">        &lt;CountDown ref=&#123; countdown =&gt; this.countDown = countdown&#125; time = '3' timeout=&#123;this.timeOut&#125; /&gt;</div><div class="line">      &lt;/View&gt;</div><div class="line">    )</div><div class="line">  &#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">AppRegistry.registerComponent('App', () =&gt; App)</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<blockquote>
<p>Note</p>
<ol>
<li>跟iOS一样如果一个传入的函数（iOS为Block），加上了括号，那么即会变成函数调用</li>
<li>根据1，在动态列表中，想传入对应参数就比较困难，所以有以下方法</li>
</ol>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">// 如何传入参数以区分不同的点击呢？</div><div class="line">arr.map(d =&gt; &lt;Text key=&#123;d.id&#125; onPress=&#123;this.handlePress&#125;&gt;&#123;d.text&#125;&lt;/Text&gt;)</div><div class="line">// 错误使用，这么做会直接执行</div><div class="line">arr.map(d =&gt; &lt;Text key=&#123;d.id&#125; onPress=&#123;this.handlePress(d.id)&#125;&gt;&#123;d.text&#125;&lt;/Text&gt;)</div><div class="line"></div><div class="line">// 正确使用</div><div class="line">arr.map(d =&gt; &lt;Text key=&#123;d.id&#125; onPress=&#123;() =&gt; this.handlePress(d.id)&#125;&gt;&#123;d.text&#125;&lt;/Text&gt;)</div><div class="line">arr.map(d =&gt; &lt;Text key=&#123;d.id&#125; onPress=&#123;this.handlePress.bind(this, d.id)&#125;&gt;&#123;d.text&#125;&lt;/Text&gt;)</div><div class="line">正确！箭头函数或bind都会生成新函数。传入参数以闭包的形式“封存”，留待调用。</div></pre></td></tr></table></figure>
<blockquote>
<p>这里有个坑，父类传到子类，因为函数被bind或者箭头函数重新进行了包装，所以在传参的时候，用在新的参数里面重新添加参数<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 实例代码</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">CountDown</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</div><div class="line">  state = &#123;</div><div class="line">    <span class="attr">count</span>: <span class="keyword">this</span>.props.time,</div><div class="line">  &#125;;</div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">const</span> &#123; count &#125; = <span class="keyword">this</span>.state;</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">        &lt;Text&gt;&#123;count&#125;&lt;/Text&gt;</div><div class="line">    )</div><div class="line">  &#125;</div><div class="line">  add = <span class="function">(<span class="params">time</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">this</span>.setState(&#123;</div><div class="line">      <span class="attr">count</span>: <span class="keyword">this</span>.state.count + time</div><div class="line">    &#125;)</div><div class="line">  &#125;</div><div class="line">  componentDidMount() &#123;</div><div class="line">    <span class="keyword">this</span>.timer = setInterval(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">      <span class="keyword">const</span> &#123; count &#125; = <span class="keyword">this</span>.state;</div><div class="line">      <span class="keyword">if</span> (count === <span class="number">0</span>) &#123;</div><div class="line">        <span class="keyword">this</span>.props.timeout &amp;&amp; <span class="keyword">this</span>.props.timeout(<span class="string">"123"</span>);</div><div class="line">        <span class="keyword">return</span> clearInterval(<span class="keyword">this</span>.timer);</div><div class="line">      &#125;</div><div class="line">      <span class="keyword">this</span>.setState(&#123;</div><div class="line">        <span class="attr">count</span>: count - <span class="number">1</span>,</div><div class="line">      &#125;);</div><div class="line">    &#125;, <span class="number">1000</span>);</div><div class="line">  &#125;</div><div class="line">  componentWillUnmount() &#123;</div><div class="line">    clearInterval(<span class="keyword">this</span>.timer);</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</div><div class="line">  addTime = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">    <span class="keyword">this</span>.countDown.add(<span class="number">5</span>)</div><div class="line">  &#125;</div><div class="line">  timeOut = <span class="function">(<span class="params">params1,params2</span>) =&gt;</span> &#123;</div><div class="line">    alert(<span class="string">'爸爸知道了'</span> + params1 + params2)</div><div class="line">  &#125;</div><div class="line">  state = &#123;</div><div class="line">    <span class="attr">arr</span>: [<span class="number">5</span>,<span class="number">4</span>,<span class="number">3</span>]</div><div class="line">  &#125;</div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      &lt;View&gt;</div><div class="line">        &#123;</div><div class="line">          this.state.arr.map (i =&gt; &#123;</div><div class="line">            return &lt;CountDown key=&#123;i&#125; time=&#123;i&#125; timeout=&#123;(child) =&gt; this.timeOut(i,child)&#125;/&gt;</div><div class="line">          &#125;)</div><div class="line">        &#125;</div><div class="line">      &lt;/View&gt;</div><div class="line">    )</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line">AppRegistry.registerComponent('App', () =&gt; App)</div></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="双向通信"><a href="#双向通信" class="headerlink" title="双向通信"></a>双向通信</h3><ol>
<li>全局时间订阅系统（EventEmitter）</li>
<li>（Flux系）单向数据流框架<ul>
<li>flux</li>
<li>reflux</li>
<li>alt</li>
<li>redux</li>
</ul>
</li>
<li>双向数据流狂阶<ul>
<li>mobx</li>
</ul>
</li>
</ol>
</div></article></div></main><footer><div class="paginator"><a href="/2018/01/06/2017傻瓜式总结/" class="prev">上一篇</a><a href="/2017/09/12/RN晴明视频学习笔记-第三章/" class="next">下一篇</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'zhz';
var disqus_identifier = '2017/10/11/晴明视频学习笔记-第四章/';
var disqus_title = 'RN晴明视频学习笔记 - 第四章';
var disqus_url = 'http://www.zhz.io/2017/10/11/晴明视频学习笔记-第四章/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//zhz.disqus.com/count.js" async></script><div class="copyright"><p>© 2016 - 2018 <a href="http://www.zhz.io">HongZhi</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-82278125-1",'auto');ga('send','pageview');</script></body></html>