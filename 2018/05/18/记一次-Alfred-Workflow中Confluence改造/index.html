<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 记一次 Alfred Workflow中Confluence改造 · 红纸</title><meta name="description" content="记一次 Alfred Workflow中Confluence改造 - HongZhi"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://www.zhz.io/atom.xml" title="红纸"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/nianran" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">记一次 Alfred Workflow中Confluence改造</h1><div class="post-info">May 18, 2018</div><div class="post-content"><h2 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h2><p>Confluence对于企业来说是一个非常有用的文档管理工具，但是每次我在使用的时候，我都要去进行一遍文档空间的目录查找。<br>虽然提供了搜索功能，但是搜索的延时，使用便捷度，都存在一定的问题。（哦，对了我们的Confluence是比较低版本的，太老了，一次搜索50条）<br>那么，想了一下如何去解决这个问题呢，Mac中万能的Alfred Workflow就是用来解决一系列的工作效率的问题的。<br>所以我在尝试能不能用Alfred Workflow来进行文档标题的搜索。<br>OK做这个事情之前，先找下目前有没有已经存在的包拿来直接使用。<br>找到了这个<a href="https://github.com/skleinei/alfred-confluence" target="_blank" rel="noopener">Alfred Workflow</a>，但是按照他的设置却发现搜索不了结果。</p>
<h2 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h2><p>OK，我们都知道Alfred Workflow是用python写的，- -好吧，Python早忘光了，反正语言嘛，80%都一样的，就随便改改好了。<br>OK，在Debug信息中我们发现，大神写的脚本的链接直接报了404<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">14:28:40 alfred-confluence.py:99 DEBUG    Quick Search URL: http://host/json/contentnamesearch.action/rest/quicknav/1/search?os_authType=basic&amp;query=ios</div><div class="line">14:28:40 workflow.py:2243 ERROR    HTTP Error 404: Not Found</div></pre></td></tr></table></figure></p>
<p>那么我们来找下公司的搜索按钮的URL来试试？<br><a href="http://host/dosearchsite.action?spaceSearch=false&amp;queryString=" target="_blank" rel="noopener">http://host/dosearchsite.action?spaceSearch=false&amp;queryString=</a><br>好像也有问题，因为他输出的是Html内容，我并不能去解析Html的东西，哇贼烦，看看有没有Rest API可以直接调用。<br>既然是Confluence，应该有API文档的吧，找到公司的Confluence版本，然后Google了一番，找到了这个<a href="https://docs.atlassian.com/DAC/rest/confluence/4.3.7.html" target="_blank" rel="noopener">链接</a>看到了图片中的这个，哇这个不就是我们想要的么。<br><img src="/resources/C11BDD5598E2284CFDA97A55806AC3EF.jpg =634x111" alt="IMAGE"><br><img src="/resources/C3533F3284F01E0B5AB879A8E173EEFD.jpg =969x822" alt="IMAGE"><br>OK，我们直接把链接给复制进去，改了下host。然后进行DEBUG，哇爆炸，还是不行。拿到的参数不是JSON，大神写的无法解析。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">14:36:21 alfred-confluence.py:99 DEBUG    Quick Search URL: http://hots/rest/prototype/1/search?os_authType=basic&amp;query=ios&amp;spaceKey=xxxx&amp;pageSize=10</div><div class="line">14:36:25 workflow.py:2243 ERROR    No JSON object could be decoded</div></pre></td></tr></table></figure></p>
<p>OK，我们去直接用阅览器访问链接（因为阅览器有登录Cookie，所以可以直接进行访问），得到的数据是XML，哇爆炸，贼不想搞这东西。<br>但是没办法，还是要用的。<br>那么问题处在XML没办法解析，得不到最终的数据。那么就来解析XML吧，- -我个人喜欢JSON，直接去Google了一个XML转JSON的库，来做（主要是，试了好几个自己写的转换莫名其妙的有问题）。OK，安装上xml2Json库，很快我们就可以得到了Json串，然后Json转字典。OK我们就可以直接用KVC的方式把pageId和title给拿出来。然后把数据添加到Alfred的FeedBack之中。<br>OK，我们想要的数据就出来的。</p>
<h2 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h2><p>受限于公司Confluence的渣渣访问速度，只能针对于搜索条数和访问空间进行限制。<br>设置完之后的访问速度大概是1.5S左右，达到了个人理想的访问速度，还是比较能够接受的。</p>
</div></article></div></main><footer><div class="paginator"><a href="/2018/05/05/OC-疯人院-引用计数/" class="next">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'zhz';
var disqus_identifier = '2018/05/18/记一次-Alfred-Workflow中Confluence改造/';
var disqus_title = '记一次 Alfred Workflow中Confluence改造';
var disqus_url = 'http://www.zhz.io/2018/05/18/记一次-Alfred-Workflow中Confluence改造/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//zhz.disqus.com/count.js" async></script><div class="copyright"><p>© 2016 - 2018 <a href="http://www.zhz.io">HongZhi</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-82278125-1",'auto');ga('send','pageview');</script></body></html>